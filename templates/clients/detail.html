{% extends "layout.html" %}
{% block title %}Client Detail{% endblock %}

{% block main %}

    <!-- Title + Avatar -->
    <div class="d-flex align-items-center my-4">

        {% set parts = client["name"].split() %}
        {% set initials = parts[0][0] + (parts[1][0] if parts|length > 1 else '') %}

        <!-- Avatar -->
        <div class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center me-3 client_avatar">
            {{ initials|upper }}
        </div>

        <div>
            <h2 class="mb-0 text-primary">{{ client["name"] }}</h2>
            <p class="text-muted mb-0">{{ client["company"] }}</p>
        </div>
        
    </div>
    
    <!-- Edit and Delete Btns -->
    <div class="d-flex gap-2">
        <a href="{{ url_for('edit_client', client_id=client['id']) }}"
           class="btn btn-outline-primary btn-sm">
            Edit Client
        </a>

        <form action="{{ url_for('delete_client', client_id=client['id']) }}"
              method="post"
              onsubmit="return confirm('Are you sure you want to delete this client?');">
            <button type="submit" class="btn btn-outline-danger btn-sm">
                Delete
            </button>
        </form>
    </div>

    <hr>

    <!-- Contact Info -->
    <h4 class="text-primary mb-3">Contact Information</h4>

    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <strong>Email:</strong>
            <p>{{ client["email"] }}</p>
        </div>
        <div class="col-md-3 mb-3">
            <strong>Phone:</strong>
            <p>{{ client["phone"] }}</p>
        </div>
        <div class="col-md-3 mb-3">
            <strong>Total Projects:</strong>
            <p>{{ projects|length }}</p>
        </div>
        <div class="col-md-3 mb-3">
            <strong>Open Projects:</strong>
            {% if open_projects != 0 %}
                <p>{{ open_projects }}</p>
            {% else %}
                <p>0</p>
            {% endif %}

        </div>
    </div>

    <hr>

    <!-- Projects List -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-primary mb-0">Projects</h4>
        <a href="{{ url_for('new_project', client_id=client['id']) }}" class="btn btn-primary btn-sm">Add Project</a>
    </div>

    <div class="table-responsive mb-4">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th class="text-primary">Project</th>
                    <th class="text-primary">Status</th>
                    <th class="text-primary">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                <tr>
                    <td>{{ project["name"] }}</td>
                    <td>{{ project["status"] }}</td>
                    <td>
                        <a href="{{ url_for('project_detail', project_id = project['id']) }}" class="btn btn-sm btn-outline-primary">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <hr>

    <!-- Notes -->
    <h4 class="text-primary mb-3">Notes</h4>
    <div class="card shadow-sm">
        <div class="card-body">
            <p class="mb-0">{{ client["notes"] }}</p>
        </div>
    </div>

{% endblock %}
