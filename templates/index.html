{% extends "layout.html" %}
{% block title %}Dashboard{% endblock %}

{% block main %}


    <!-- Título -->
    <div class="d-flex align-items-center mb-4">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="rgb(13, 110, 253)" class="me-3" viewBox="0 0 256 256">
            <path d="M207.06,72.67A111.24,111.24,0,0,0,128,40h-.4C66.07,40.21,16,91,16,153.13V176a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V152A111.25,111.25,0,0,0,207.06,72.67ZM224,176H119.71l54.76-75.3a8,8,0,0,0-12.94-9.42L99.92,176H32V153.13c0-3.08.15-6.12.43-9.13H56a8,8,0,0,0,0-16H35.27c10.32-38.86,44-68.24,84.73-71.66V80a8,8,0,0,0,16,0V56.33A96.14,96.14,0,0,1,221,128H200a8,8,0,0,0,0,16h23.67c.21,2.65.33,5.31.33,8Z"></path>
        </svg>
        <h2 class="text-primary mb-0">Dashboard</h2>
    </div>

    <hr>

    <!-- Cards de métricas -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase">Clients</h6>
                    <p class="display-6 mb-0">{{ data['total_clients'] }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase">Projects</h6>
                    <p class="display-6 mb-0">{{ data['total_projects'] }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase">In Progress</h6>
                    <p class="fs-3 mb-0 text-warning">{{ data['in_progress'] }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase">Pending</h6>
                    <p class="fs-3 mb-0 text-secondary">{{ data['pending'] }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase">Completed</h6>
                    <p class="fs-3 mb-0 text-success">{{ data['completed'] }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Linha com dois blocos: Upcoming Projects + Top Clients -->
    <div class="row g-3 flex-grow-1">

        <!-- Upcoming projects -->
        <div class="col-md-7 d-flex">
            <div class="card shadow-sm border-0 flex-grow-1">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-primary">Upcoming projects</h5>
                    <a href="{{ url_for('projects') }}" class="small text-decoration-none">View all</a>
                </div>
                <div class="card-body">
                    {% if data['upcoming_projects'] %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-primary">Project</th>
                                        <th class="text-primary">Client</th>
                                        <th class="text-primary">Due date</th>
                                        <th class="text-primary">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in data['upcoming_projects'] %}
                                    <tr>
                                        <td>
                                            <a href="{{ url_for('project_detail', project_id=project.id) }}">
                                                {{ project.name }}
                                            </a>
                                        </td>
                                        <td>
                                            <a href="{{ url_for('client_detail', client_id=project.client_id) }}">
                                                {{ project.client_name }}
                                            </a>
                                        </td>
                                        <td>{{ project.due_date or '-' }}</td>
                                        <td>
                                            <span class="badge
                                                {% if project.status == 'Completed' %}
                                                    bg-success
                                                {% elif project.status == 'In Progress' %}
                                                    bg-warning text-dark
                                                {% elif project.status == 'Pending' %}
                                                    bg-secondary
                                                {% else %}
                                                    bg-light text-dark
                                                {% endif %}
                                            ">
                                                {{ project.status }}
                                            </span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">No upcoming projects with due dates set.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Top clients -->
        <div class="col-md-5 d-flex">
            <div class="card shadow-sm border-0 flex-grow-1">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-primary">Top clients</h5>
                    <a href="{{ url_for('clients') }}" class="small text-decoration-none">View all</a>
                </div>
                <div class="card-body">
                    {% if data['top_clients'] %}
                        <ul class="list-group list-group-flush">
                            {% for client in data['top_clients'] %}
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <div>
                                    <a href="{{ url_for('client_detail', client_id=client.id) }}">
                                        {{ client.name }}
                                    </a>
                                    <div class="small text-muted">{{ client.company }}</div>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    {{ client.total_projects }} projects
                                </span>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted mb-0">No clients registered yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>


{% endblock %}
